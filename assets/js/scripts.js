var zeeba_stripe;
(function($) { // Containing everything neatly in an object so we can call everything
    zeeba_stripe = {
        //card: {},
        el_card: {},
        api_key: "...", // Found in an <element data-stripe-key="..."> instead
        api_key_el: {},
        load_stripe_api: function() {

            // Only load if a key exists on this page
            if ($("[data-stripe-key]").length <= 0) {
                return;
            }

            // This element may have options attached to it
            zeeba_stripe.api_key_el = $("[data-stripe-key]");


            if (typeof Stripe === "undefined") {
                // Setup the StripeJS <script> element because it isn't loaded yet
                var stripe_script = document.createElement('script');
                stripe_script.type = 'text/javascript';
                stripe_script.src = 'https://js.stripe.com/v3/';
                document.body.appendChild(stripe_script);


                stripe_script.onload = function() {

                    // Create a Stripe client.
                    try {
                        //window.stripe_api_key = zeeba_stripe.api_key;
                        window.stripe_api_key = zeeba_stripe.api_key_el.attr("data-stripe-key");
                        window.stripe_obj = Stripe(stripe_api_key);
                    }
                    catch (e) {
                        console.log("Error creating Stripe object.");
                        console.log(e);
                        return;
                    }

                    // This is an async call.
                    // So we will need to declare onload stuff in another func
                    zeeba_stripe.after_stripe_onload();
                };
            }
        },
        after_stripe_onload: function() {

            // Custom stripe styles that must be defined in JS
            // See https://stripe.com/docs/stripe-js/elements/quickstart
            var stripe_styles = {
                base: {
                    color: '#32325d',
                    fontFamily: '"Montserrat", sans-serif',
                    fontSmoothing: 'antialiased',
                    fontSize: '13px',
                    '::placeholder': {
                        color: '#d6d8d9'
                    }
                },
                invalid: {
                    color: '#fa755a',
                    iconColor: '#fa755a'
                }
            };

            // 2. Create an instance of the card Element.
            var stripe_elements = window.stripe_obj.elements();

            if (zeeba_stripe.api_key_el.attr("data-stripe-mode") == "minimal") {
                zeeba_stripe.el_card = stripe_elements.create('cardNumber', { style: stripe_styles });
                zeeba_stripe.el_card.mount('#card-number');

                zeeba_stripe.el_card_exp = stripe_elements.create('cardExpiry', { style: stripe_styles });
                zeeba_stripe.el_card_exp.mount('#card-exp');
            }
            else {
                zeeba_stripe.el_card = stripe_elements.create('card', { style: stripe_styles });
                zeeba_stripe.el_card.mount('#card-number');
            }


            /*
            zeeba_stripe.el_card.on('change', function(event) {
                zeeba_stripe.set_outcome(event);
            });
            */

            // On submit, we will handle the token generated by the credit card
            //$("form#step-4-form").on('submit', zeeba_stripe.on_formsubmit);
        },
        /*
        set_outcome: function(result) {

        },*/
        on_formsubmit: function(callback_func) {

            window.stripe_obj.createToken(zeeba_stripe.el_card).then(function(result) {

                // Save token to the stripe_token input box
                if (result.token) {
                    $("[name=stripe_token]").val(result.token.id);

                    console.log("Stripe Token");
                    console.log(result);

                    callback_func();

                } else if (result.error) {
                    // Handle error
                    //errorElement.textContent = result.error.message;
                    //errorElement.classList.add('visible');
                    console.log("Stripe Error");
                    console.log(result.error.message);

                    alert("Stripe Error\r\n" + result.error.message);


                    $('#step_submit').prop('disabled', false);
                    $('#step_submit').removeClass('loading');
                }
            });//(zeeba_stripe.set_outcome);


        }
    };

    // START HERE: Everything starts with this call.
    zeeba_stripe.load_stripe_api();

})(jQuery);


jQuery(document).ready(function () {
    let ajax_url = '/wp-admin/admin-ajax.php';

    step_4_fileupload();
    step_4_agreement();
    step_4_add_driver();
    flightEnabled();
    step4Submit();
    //step3RateCalculate();

    /* start new design js*/


        // checking if already any value exist
        let zeebaLhgInputVal =  jQuery(".zeeba-lhg-single-input-group input").val();
        let zeebaLhgSelectVal =  jQuery(".zeeba-lhg-single-input-group select").val();
        if(zeebaLhgInputVal != ""){
            jQuery(this).siblings("label").addClass("zeeba-lhg-label-animated-up");
        }
        if(zeebaLhgSelectVal != ""){
            jQuery(this).siblings("label").addClass("zeeba-lhg-label-animated-up");
        }

        jQuery(".zeeba-lhg-single-input-group input").each(function() {
            if(jQuery(this).val() != ""){
                jQuery(this).siblings("label").addClass("zeeba-lhg-label-animated-up");
            }
        });

        // jQuery(".zeeba-lhg-single-input-group select").each(function() {
        //     if(jQuery(this).val() != ""){
        //         jQuery(this).siblings("label").addClass("zeeba-lhg-label-animated-up");
        //     }
        // });



        // Input & Select field gets animated when clicked
        jQuery(".zeeba-lhg-single-input-group input,.zeeba-lhg-single-input-group select").on("click",function(){
            jQuery(this).siblings("label").addClass("zeeba-lhg-label-animated-up");
        });


        // Input field blur
        jQuery(".zeeba-lhg-single-input-group input").on("blur",function(){
            if(jQuery(this).val() == ""){
                jQuery(this).siblings("label").removeClass("zeeba-lhg-label-animated-up").css({"transition":".4s"});
            }
        });


        // Select field blur
        jQuery(".zeeba-lhg-single-input-group select").on("blur",function(){

            jQuery(this).css({
                "color":"#fff"
            })

            if(jQuery(this).val() == ""){
                jQuery(this).siblings("label").removeClass("zeeba-lhg-label-animated-up").css({"transition":".4s"});
            }
        });

        // Return Location checkbox click
        jQuery(".zeeba-lhg-return-location-checkbox").on("click",function(){
            jQuery('input[name=returnToPickupStation]').prop("checked",true)
            jQuery(this).fadeOut(function(){
                jQuery(this).next().fadeIn();
            });

        });

        if(jQuery("input[name=returnToPickupStation]").is(":checked")){
            jQuery(".zeeba-lhg-return-location-checkbox").fadeOut(function(){
                jQuery(".zeeba-lhg-return-location-checkbox").next().fadeIn();
            });
        }


        // Return location close button click
        jQuery(".zeeba-lhg-single-input-group .zeeba-lhg-close-button").on("click",function(){
            jQuery(this).parent().fadeOut(function(){
                jQuery(this).prev().fadeIn();
                jQuery(this).prev().find("input").prop("checked",false)
            });

            jQuery('#returnStation').val(''); // Set select value as null
            jQuery(this).siblings("label").removeClass("zeeba-lhg-label-animated-up").css({"transition":".4s"});

        });
    /* end new design js*/


    let step1_menu_width = jQuery("#step1-menu").children().eq(0).outerWidth(true);
    let step1_menu_height = jQuery("#step1-menu").children().eq(0).outerHeight(true);
    jQuery("#vehicle").outerWidth(step1_menu_width);
    jQuery("#vehicle").outerHeight(step1_menu_height);
    let pickup_input_width = jQuery("#pickupStation").outerWidth(true);
    jQuery("#return-tick").css({'left': pickup_input_width + 8});
    jQuery("#pickup-return-time").css({'left': -12});
    // jQuery("#returnStation").css({'margin-left': -22});
    jQuery("#dropoff-datetimepicker").css({'margin-left': -7});
    // jQuery("#returnStation").outerWidth(pickup_input_width);
    //jQuery("#pickup-datetimepicker").outerWidth(pickup_input_width);
    //jQuery("#dropoff-datetimepicker").outerWidth(pickup_input_width);
    // jQuery("span.select2.select2-container.select2-container--default").outerWidth(pickup_input_width);

    feather.replace();

    /* Select Location */
    jQuery('.zeeba_select2').select2();
    /* ./Select Location */

    /* form step selector */

    // set default step
    let currentStep = 0,
        isValid = false,
        isLoading = false;


    /**
     * @param isLoading
     * @returns void
     */
    function setLoaderStatus(isLoading) {
        if(isLoading){
            jQuery('.zeeba_loader').css({display: 'flex'});
        }else{
            jQuery('.zeeba_loader').css({display: 'none'});
        }
    }
    // set default loader status to false
    setLoaderStatus(false);

    /**
     * @param step
     * @returns boolean
     */
    function stepValidator(step) {

        return true;
    }

    /**
     * @param: step
     * @returns void
     */
    function setStep(step) {
        // hide all steps
        jQuery('.zeeba_form.step').css({display:'none'});

        // show current step
        jQuery('.zeeba_form.step').eq(step).css({display:'block'});
    }

    // set default step
    setStep(currentStep);

    // Go to previus step
    jQuery('.prev_step').on('click',function () {
        // jQuery('#all-vehicles').html('');
        // all_vehicles = '';
        currentStep -= 1;
        setStep(currentStep);
    });
    /* end form step selector */

    /* adding additional driver */
    jQuery('#addAdditional').on('click', function(e) {
        let driver = jQuery('.zeeba_add_drivers .driver').first();
       driver.clone().insertAfter(jQuery('.zeeba_add_drivers .driver').last());
    });
    /* ./adding additional driver */

    let loc, return_loc, pick_up_date, drop_off_date, value_vehicle, next_url;
    let data_code, data_code_return, value_loc, value_return_loc, get_days;

    jQuery('#stepper2').on('click', function(){
        if(currentStep > 1)
            backStep(2);
    });
    jQuery('#stepper3').on('click', function(){
        if(currentStep >= 3)
            backStep(3);
    });
    jQuery('#stepper4').on('click', function(){
        if(currentStep >= 4)
            backStep(4);
    });
    function backStep(step) {
        jQuery('.zeeba_form.step').eq(1).css({display:'none'});
        jQuery('.zeeba_form.step').eq(2).css({display:'none'});
        jQuery('.zeeba_form.step').eq(3).css({display:'none'});
        jQuery('.zeeba_form.step').eq(4).css({display:'none'});
        jQuery('#step'+step).css('display','block');
    }

    $page_input = jQuery('#page_input').val();
    if($page_input == 'start'){
        start_submit();
    }
    if($page_input == 'next'){
        step_2_load();
        step_1_submit();
    }

    /********* Ajax *********/
        //start-page-submit
        function start_submit() {
            jQuery('.step_1_submit').click( function(){
                jQuery(this).text('loading.....');
                loc = jQuery("#pickupStation option:selected").text()+', '+jQuery("#pickupStation option:selected").attr('data-group');
                return_loc = jQuery("#returnStation option:selected").text()+', '+jQuery("#returnStation option:selected").attr('data-group');
                pick_up_date = jQuery("#pickup-datetimepicker").val();
                drop_off_date = jQuery("#dropoff-datetimepicker").val();
                value_vehicle = jQuery("#vehicle").find('option:selected').attr('value');
                data_code = jQuery("#location-code").val();
                data_code_return = jQuery("#return-location-code").val();
                value_loc = jQuery("#location").val();
                value_return_loc = jQuery("#return-location").val();
                discount = jQuery("#promotion").val();
                next_url = jQuery("input[name=next_url]").val();

                let data = {
                    'action': 'step1',
                    'data': {
                        'pickup_date': pick_up_date,
                        'dropoff_date': drop_off_date,
                        'pickup_location': data_code,
                        'pickup_location_select': value_loc,
                        'pickup_location_text': loc,
                        'dropoff_location': data_code_return,
                        'dropoff_location_select': value_return_loc,
                        'dropoff_location_text': return_loc,
                        'van_type': value_vehicle,
                        'discount_code': discount,
                        'next_url' : next_url
                    }
                };
                if(jQuery("input[name=returnToPickupStation]").is(":checked")){
                    data['data']['different_location'] = "yes";
                }
                else{
                    data['data']['different_location'] = "no";
                    return_loc = loc;
                }
                // We can also pass the url value separately from ajaxurl for front end AJAX implementations
                jQuery.post(ajax_url, data, function(error) {
                    error = jQuery.parseJSON(error);

                    if(error['ok'] && error['ok'] == 'ok'){
                        window.location.replace('/'+next_url);
                        // jQuery('.step_1_submit').text('Find Vehicle');
                        currentStep = 2;
                    }
                    else{
                        jQuery('.step_1_submit').text('Find Vehicle');
                        if(error['pickup_date']){
                            alert(error['pickup_date']);
                        }
                        else if(error['pickup_time']){
                            alert(error['pickup_time']);
                        }
                        else if(error['pt']){
                            alert(error['pt']);
                        }
                        else if(error['dropoff_date']){
                            alert(error['dropoff_date']);
                        }
                        else if(error['dropoff_time']){
                            alert(error['dropoff_time']);
                        }
                        else if(error['dt']){
                            alert(error['dt']);
                        }
                        else if(error['van_type']){
                            alert(error['van_type']);
                        }
                        else if(error['pickup_location']){
                            alert(error['pickup_location']);
                        }
                        else if(error['different_location']){
                            alert(error['different_location']);
                        }
                        else if(error['dropoff_location']){
                            alert(error['dropoff_location']);
                        }
                        else{
                            currentStep = 1;
                            jQuery('.step_1_submit').text('Find Vehicle');
                        }
                    }

                });

            });
        }

        function step_1_submit() {
            jQuery('.step_1_submit').click( function(){
                jQuery(this).text('loading.....');
                loc = jQuery("#pickupStation option:selected").text()+', '+jQuery("#pickupStation option:selected").attr('data-group');
                return_loc = jQuery("#returnStation option:selected").text()+', '+jQuery("#returnStation option:selected").attr('data-group');

                // loc = jQuery("#pickupStation").val();
                // return_loc = jQuery("#returnStation").val();
                pick_up_date = jQuery("#pickup-datetimepicker").val();
                drop_off_date = jQuery("#dropoff-datetimepicker").val();
                value_vehicle = jQuery("#vehicle").find('option:selected').attr('value');
                data_code = jQuery("#location-code").val();
                data_code_return = jQuery("#return-location-code").val();
                value_loc = jQuery("#location").val();
                value_return_loc = jQuery("#return-location").val();
                discount = jQuery("#promotion").val();

                let data = {
                    'action': 'step1',
                    'data': {
                        'pickup_date': pick_up_date,
                        'dropoff_date': drop_off_date,
                        'pickup_location': data_code,
                        'pickup_location_select': value_loc,
                        'pickup_location_text': loc,
                        'dropoff_location': data_code_return,
                        'dropoff_location_select': value_return_loc,
                        'dropoff_location_text': return_loc,
                        'van_type': value_vehicle,
                        'discount_code': discount
                    }
                };
                if(jQuery("input[name=returnToPickupStation]").is(":checked")){
                    data['data']['different_location'] = "yes";
                }
                else{
                    data['data']['different_location'] = "no";
                    return_loc = loc;
                }
                // We can also pass the url value separately from ajaxurl for front end AJAX implementations
                jQuery.post(ajax_url, data, function(error) {
                    error = jQuery.parseJSON(error);

                    if(error['ok'] && error['ok'] == 'ok'){

                        currentStep = 1;
                        // setStep(currentStep);
                        jQuery('.stepper-container').css({display:'block'});
                        jQuery('.zeeba_form.step').eq(0).css({display:'block'});
                        jQuery('.zeeba_form.step').eq(1).css({display:'block'});
                        jQuery('.zeeba_form.step').eq(2).css({display:'none'});
                        jQuery('.zeeba_form.step').eq(3).css({display:'none'});
                        jQuery('.zeeba_form.step').eq(4).css({display:'none'});
                        jQuery('#stepper1').addClass('completed');
                        jQuery('#stepper1').removeClass('active');
                        jQuery('#stepper2').addClass('active');
                        jQuery('#stepper3').removeClass('active');
                        jQuery('#stepper4').removeClass('active');
                        jQuery('#stepper2').removeClass('completed');
                        jQuery('#stepper3').removeClass('completed');
                        jQuery('#stepper4').removeClass('completed');
                        let i = 0;
                        let all_vehicles = vehicle_lists(error);
                        jQuery('#all-vehicles').html(all_vehicles);

                        feather.replace();
                        step2tostep3();
                        jQuery('#get-location').html(error['location']);
                        jQuery('#pickup_date').html(error['pick_up_date']);
                        jQuery('#get-return-location').html(error['return_location']);
                        jQuery('#dropoff_date').html(error['drop_off_date']);
                        jQuery("#days-count").html(error['rental_period'] + " Day(s)");
                        jQuery('.step_1_submit').text('Find Vehicle');

                    }
                    else{
                        jQuery('.step_1_submit').text('Find Vehicle');
                        if(error['pickup_date']){
                            alert(error['pickup_date']);
                        }
                        else if(error['pickup_time']){
                            alert(error['pickup_time']);
                        }
                        else if(error['pt']){
                            alert(error['pt']);
                        }
                        else if(error['dropoff_date']){
                            alert(error['dropoff_date']);
                        }
                        else if(error['dropoff_time']){
                            alert(error['dropoff_time']);
                        }
                        else if(error['dt']){
                            alert(error['dt']);
                        }
                        else if(error['van_type']){
                            alert(error['van_type']);
                        }
                        else if(error['pickup_location']){
                            alert(error['pickup_location']);
                        }
                        else if(error['different_location']){
                            alert(error['different_location']);
                        }
                        else if(error['dropoff_location']){
                            alert(error['dropoff_location']);
                        }
                        else{
                            currentStep = 1;
                            setStep(currentStep);
                        }
                    }

                });

            });
        }

        function vehicle_lists(error){
            let i = 0;
            let all_vehicles = '';

            if(error['rates_render']){
                for(vehicle in error['rates_render']) {
                    if(i==0){
                        all_vehicles += '<div class="col-md-12 mt-3">\
                              <div class="row ' + error['rates_render'][vehicle]["html"]["rate"]["vehicle-active"] + '">\
                                <div class="col-md-4 col-xs-12">\
                                  <div class="vehicle-img-container">\
                                    <img id="vehicle_img' + error['rates_render'][vehicle]["html"]["rate"]["id"] + '" src="' + error['rates_render'][vehicle]["html"]["rate"]["side_image"] + '" alt="' + error['rates_render'][vehicle]["html"]["rate"]["side_image_alt"] + '">\
                                  </div>\
                                </div>\
                                <div class="col-md-8 col-xs-12">\
                                  <div class="vehicle-title-container">\
                                    <div class="title text-lg mr-8 text-gray-800" id="vehicle_title_' +error['rates_render'][vehicle]["html"]["rate"]["id"]+ '">' + error['rates_render'][vehicle]["html"]["rate"]["vehicle_title"] + '</div>\
                                    <div class="subtitle-content">\
                                      <div class="subtitle text-gray-600">' + error['rates_render'][vehicle]["html"]["rate"]["car"] + '</div>\
                                    </div>\
                                  </div>\
                                  <div class="vehicle-price-container">\
                                    <div class="vehicle-price">\
                                      <span class="text-gray-800 mt-1 mr-1 text-lg font-bold">$' + error['rates_render'][vehicle]["html"]["rate"]["daily_rate"] + '</span>\
                                      <small class="text-gray-500">/Day</small> \
                                      <span title="Your daily rate, excluding taxes and fees"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>\
                                    </div>\
                                    <div class="vehicle-price"><span class="text-gray-800 mt-1 mr-1 text-lg font-bold">$' + error['rates_render'][vehicle]["html"]["rate"]["total"]["charge"] + '</span><small class="text-gray-500">Total</small> <span title="Your total for the entire booking, including taxes and fees"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span></div>\
                                  </div>\
                                  <div class="items-center row width-100">\
                                    <div class="items-center col-md-12 col-xs-12">\
                                      <div class="fl-left my-2"><div class=" items-center mr-3 "><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_air.png" alt="" srcset="">' + error['rates_render'][vehicle]["html"]["rate"]["air_conditioning"] +'</div></div>\
                                      <div class="fl-left my-2"><div class=" items-center mr-3 "><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_doors.png" alt="" srcset=""><span class="mt-2">' + error['rates_render'][vehicle]["html"]["rate"]["doors"] + '</span></div></div>\
                                      <div class="fl-left my-2"><div class=" items-center mr-3 "><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_gas.png" alt="" srcset=""><span class="mt-2">' + error['rates_render'][vehicle]["html"]["rate"]["mpg_min"] + '-' + error['rates_render'][vehicle]["html"]["rate"]["mpg_max"] + ' MPG</span></div></div>\
                                      <div class=" my-2"><div class=" items-center mr-3 "><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_bags.png" alt="" srcset=""><span class="mt-2">' + error['rates_render'][vehicle]["html"]["rate"]["bags"] + '</span></div></div>\
                                    </div>\
                                  </div>\
                                    <div class="additional-info-container row">\
                                      <div class="col-md-12 col-xs-12">\
                                        <span class="mt-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg></span>' + error['rates_render'][vehicle]["html"]["rate"]["rate_mileage"] +'\
                                      </div>';
                                      if(error['rates_render'][vehicle]["html"]["rate"]["asterisk_text"]){
                                            all_vehicles += '<div class="col-md-12 col-xs-12">\
                                        <span class="mt-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg></span>' + error['rates_render'][vehicle]["html"]["rate"]["rate_mileage"] +'\
                                      </div>';
                                        }
                                        all_vehicles += '</div>\
                                  <div class="my-4"><button class="select-vehicle zeeba_bg text-white font-bold py-2 px-4 step_2_submit">Select Vehicle</button>\
                                  <input type="hidden" value="' + error['rates_render'][vehicle]["html"]["rate"]["id"] + '"></div></div>\
                              </div>\
                            </div>';
                    }
                    else{
                        if(error['rates_render'][vehicle]["html"]["rate"]["total"]){
                            all_vehicles += '<div class="col-md-4 mt-3 ' + error['rates_render'][vehicle]["html"]["rate"]["vehicle-active"] + '">\
                                <div class="card">\
                                  <img src="' + error['rates_render'][vehicle]["html"]["rate"]["side_image"] + '" class="card-img-top" alt="...">\
                                  <div class="card-body">\
                                    <h5 class="card-title">' + error['rates_render'][vehicle]["html"]["rate"]["vehicle_title"] + '</h5>\
                                    <h6 class="card-subtitle mb-2 text-muted">' + error['rates_render'][vehicle]["html"]["rate"]["car"] + '</h6>\
                                    <p class="card-text"></p>\
                                    <div class="card-text offerPrice_wrapper">\
                                      <div class="offerPrice">\
                                        <span class="Price__currency">$</span><span>' + error['rates_render'][vehicle]["html"]["rate"]["daily_rate"] + '</span>\
                                        <span class="Price__valueAfterSeparator">| day</span>\
                                        <span title="Your daily rate, excluding taxes and fees">\
                                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600" title="Your total for the entire booking, including taxes and fees"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>\
                                        </span>\
                                      </div> \
                                      <div class="offerPrice">\
                                        <span class="Price__currency">$</span><span>' + error['rates_render'][vehicle]["html"]["rate"]["total"]["charge"] + '</span>\
                                        <span class="Price__valueAfterSeparator">Total</span>\
                                        <span title="Your total for the entire booking, including taxes and fees">\
                                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600" title="Your total for the entire booking, including taxes and fees"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>\
                                        </span>\
                                      </div>\
                                    </div>\
                                  </div>\
                                  <ul class="list-group list-group-flush">\
                                      <li class="list-group-item">\
                                        <div class="row miles-per small-info mb-2">\
                                          <div class="vehicle-info  col-md-4 col-xs-4">\
                                              <div title="Air Condition" class="fl-left">\
                                                <img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_air.png" alt="" srcset="">\
                                              </div>\
                                              <div class="fl-left">' + error['rates_render'][vehicle]["html"]["rate"]["air_conditioning"] + '</div>\
                                          </div>\
                                          <div class="vehicle-info col-md-8 col-xs-4"> \
                                              <div title="Doors" class="fl-left"><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_doors.png" alt="" srcset="">\
                                              </div>\
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["doors"] + '</div>\
                                          </div>\
                                        </div>\
                                        <div class="miles-per small-info row">\
                                          <div class="vehicle-info col-md-4 col-xs-4">\
                                              <div title="Bags" class="fl-left">\
                                                <img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_bags.png" alt="" srcset="">\
                                              </div>\
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["bags"] + '</div>\
                                          </div>\
                                          <div class="vehicle-info col-md-8 col-xs-4">\
                                              <div title="MPG Range" class="fl-left"><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_gas.png" alt="" srcset="">\
                                              </div>   \
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["mpg_min"] + '-' + error['rates_render'][vehicle]["html"]["rate"]["mpg_max"] + ' MPG</div>\
                                          </div> \
                                        </div>\
                                      </li>\
                                      <li class="list-group-item text-muted">';
                                        if(error['rates_render'][vehicle]["html"]["rate"]["asterisk_text"]){
                                            all_vehicles += '<div class="step2_additional_info"><span class="step2_additional_info_icon svg-check-icon">\
                                                <svg xmlns="http:https://www.w3.org/2000/svg" viewBox="0 0 16 12"><polygon fill="#191919" fill-rule="nonzero" points="3.164 9.852 2 11.008 7.05 16 18 5.154 16.834 4 7.049 13.692" transform="translate(-2 -4)"></polygon></svg>\
                                                </span>' + error['rates_render'][vehicle]["html"]["rate"]["asterisk_text"] + '</div>';
                                        }
                                        all_vehicles += '<div class="step2_additional_info"><span class="step2_additional_info_icon svg-check-icon"><svg xmlns="http:https://www.w3.org/2000/svg" viewBox="0 0 16 12"><polygon fill="#191919" fill-rule="nonzero" points="3.164 9.852 2 11.008 7.05 16 18 5.154 16.834 4 7.049 13.692" transform="translate(-2 -4)"></polygon></svg></span>' + error['rates_render'][vehicle]["html"]["rate"]["rate_mileage"] + '</div>\
                                      </li>\
                                    </ul>\
                                    <button class="select-vehicle zeeba_bg text-white py-2 px-4 step_2_submit">Select Vehicle</button>\
                                    <input type="hidden" value="' + error['rates_render'][vehicle]["html"]["rate"]["id"] + '">\
                                    </div>\
                              </div>';
                        }
                        else{
                            all_vehicles += '<div class="col-md-4 mt-3 ' + error['rates_render'][vehicle]["html"]["rate"]["vehicle-active"] + '">\
                                <div class="card">\
                                  <img src="' + error['rates_render'][vehicle]["html"]["rate"]["side_image"] + '" class="card-img-top" alt="...">\
                                  <div class="card-body">\
                                    <h5 class="card-title">' + error['rates_render'][vehicle]["html"]["rate"]["vehicle_title"] + '</h5>\
                                    <h6 class="card-subtitle mb-2 text-muted">' + error['rates_render'][vehicle]["html"]["rate"]["car"] + '</h6>\
                                    <p class="card-text"></p>\
                                  </div>\
                                  <ul class="list-group list-group-flush">\
                                      <li class="list-group-item">\
                                        <div class="row miles-per small-info mb-2">\
                                          <div class="vehicle-info  col-md-4 col-xs-4">\
                                              <div title="Air Condition" class="fl-left">\
                                                <img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_air.png" alt="" srcset="">\
                                              </div>\
                                              <div class="fl-left">' + error['rates_render'][vehicle]["html"]["rate"]["air_conditioning"] +'</div>\
                                          </div>\
                                          <div class="vehicle-info col-md-8 col-xs-4"> \
                                              <div title="Doors" class="fl-left"><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_doors.png" alt="" srcset="">\
                                              </div>\
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["doors"] + '</div>\
                                          </div>\
                                        </div>\
                                        <div class="miles-per small-info row">\
                                          <div class="vehicle-info col-md-4 col-xs-4">\
                                              <div title="Bags" class="fl-left">\
                                                <img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_bags.png" alt="" srcset="">\
                                              </div>\
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["bags"] + '</div>\
                                          </div>\
                                          <div class="vehicle-info col-md-8 col-xs-4">\
                                              <div title="MPG Range" class="fl-left"><img class="w-8 h-6 mr-1" src="'+ error['dir'] +'icons/icon_specs_gas.png" alt="" srcset="">\
                                              </div>   \
                                              <div class="">' + error['rates_render'][vehicle]["html"]["rate"]["mpg_min"] + '-' + error['rates_render'][vehicle]["html"]["rate"]["mpg_max"] + ' MPG</div>\
                                          </div> \
                                        </div>\
                                      </li>\
                                      <li class="list-group-item text-muted">';
                                        if(error['rates_render'][vehicle]["html"]["rate"]["asterisk_text"]){
                                            all_vehicles += '<div class="step2_additional_info"><span class="step2_additional_info_icon svg-check-icon">\
                                                <svg xmlns="http:https://www.w3.org/2000/svg" viewBox="0 0 16 12"><polygon fill="#191919" fill-rule="nonzero" points="3.164 9.852 2 11.008 7.05 16 18 5.154 16.834 4 7.049 13.692" transform="translate(-2 -4)"></polygon></svg>\
                                                </span>' + error['rates_render'][vehicle]["html"]["rate"]["asterisk_text"] + '</div>';
                                        }
                                        all_vehicles += '<div class="step2_additional_info"><span class="step2_additional_info_icon svg-check-icon"><svg xmlns="http:https://www.w3.org/2000/svg" viewBox="0 0 16 12"><polygon fill="#191919" fill-rule="nonzero" points="3.164 9.852 2 11.008 7.05 16 18 5.154 16.834 4 7.049 13.692" transform="translate(-2 -4)"></polygon></svg></span>' + error['rates_render'][vehicle]["html"]["rate"]["rate_mileage"] + '</div>\
                                      </li>\
                                    </ul>\
                                    <input type="hidden" value="' + error['rates_render'][vehicle]["html"]["rate"]["id"] + '">\
                                    <button class="select-vehicle zeeba_bg text-white py-2 px-4 disabled">Unavailable</button>\
                                </div>\
                              </div>';
                        }
                    }
                    i++;
                }
            }else{
                all_vehicles += '<li class="flex width-100 p-2"><h5 class=" text-center text-danger">No vehicle is available</h5></li>';
            }
            return all_vehicles;
        }
        // step2tostep3();

        function step_2_load() {
            let data = {
                'action': 'step_2_load'
            };
            jQuery.post(ajax_url, data, function(error) {
                error = jQuery.parseJSON(error);
                if (error['ok'] && error['ok'] == 'ok') {
                    currentStep = 2;
                    jQuery('.zeeba_form.step').eq(0).css({display:'block'});
                    jQuery('.zeeba_form.step').eq(1).css({display:'block'});
                    jQuery('.zeeba_form.step').eq(2).css({display:'none'});
                    jQuery('.zeeba_form.step').eq(3).css({display:'none'});
                    jQuery('#stepper1').addClass('completed');
                    jQuery('#stepper1').removeClass('active');
                    jQuery('#stepper2').addClass('active');
                    jQuery('#stepper3').removeClass('active');
                    jQuery('#stepper4').removeClass('active');
                    jQuery('#stepper2').removeClass('completed');
                    jQuery('#stepper3').removeClass('completed');
                    jQuery('#stepper4').removeClass('completed');
                    let i = 0;
                    let all_vehicles = vehicle_lists(error);
                    jQuery('#all-vehicles').html(all_vehicles);

                    feather.replace();
                    step2tostep3();
                    jQuery('#get-location').html(error['location']);
                    jQuery('#pickup_date').html(error['pick_up_date']);
                    jQuery('#get-return-location').html(error['return_location']);
                    jQuery('#dropoff_date').html(error['drop_off_date']);
                    jQuery("#days-count").html(error['rental_period'] + " Day(s)");
                    jQuery('.step_1_submit').text('Find Vehicle');
                }
            });
        }

        // step2tostep3();
        //step3RateCalculate();
        sendRateQuoteEmail();
        roundupCalculationBtn();
        step3tostep4();
        function step2tostep3(){
            jQuery('.step_2_submit').click( function(){
                jQuery('.donation-td').remove();
                let url = '/wp-admin/admin-ajax.php';
                let rate_id = jQuery(this).next().val();
                jQuery(this).html('<span class="spinner-grow text-success spinner-grow-sm" role="status" aria-hidden="true"></span><span class="">Loading...</span>');
                jQuery(this).addClass('disabled');
                let data = {
                        'action': 'step2',
                        'data': {
                            'rate': rate_id,
                        }
                };
                jQuery.post(url, data, function(response) {
                    error = jQuery.parseJSON(response);
                    console.log(error);

                    if(error['result'] && error['result'] == 'OK'){

                        currentStep = 3;
                        // setStep(currentStep);
                        jQuery('.zeeba_form.step').eq(0).css({display:'block'});
                        jQuery('.zeeba_form.step').eq(1).css({display:'none'});
                        jQuery('.zeeba_form.step').eq(2).css({display:'block'});
                        jQuery('.zeeba_form.step').eq(4).css({display:'none'});
                        jQuery('#stepper2').addClass('completed');
                        jQuery('#stepper2').removeClass('active');
                        jQuery('#stepper3').removeClass('completed');
                        jQuery('#stepper3').addClass('active');
                        jQuery('#stepper4').removeClass('active');
                        jQuery('#stepper4').removeClass('completed');

                        // // start step3 show data
                        // jQuery('#step3-van-title').text(error['rate']['vehicle_title']);
                        // jQuery('#step3-van-img').attr('src',error['rate']['side_image']);
                        jQuery('.select-van-title').text(error['vehicle_title']);
                        jQuery('.select-van-img').attr('src',error['vehicle_img']);
                        jQuery('#step3-rate-container').addClass('displaynone');
                        jQuery('#step3-rate-calculate').removeClass('displaynone');
                        jQuery('#step3-rate-recalculate').addClass('displaynone');
                        // start step3 show rate data
                        $rate_quote_tbl_content = rateTableData();
                        jQuery('.rate_quote_tbl tbody').html($rate_quote_tbl_content);
                        $step3_rate_total_charge = 0
						// jQuery('#rental_rate_detail').text(error['rate']['total']['days']+' day(s) @ '+error['rate']['amount']);
                        jQuery('#rental_rate_detail').text(error['rate']['total']['days']+' day(s) @ '+error['rate']['daily_rate']);
                        jQuery('#rental_rate_cost').text('$'+error['rate']['total']['rate_charge']);
                        $step3_rate_total_charge = sum(error['rate']['total']['rate_charge'], $step3_rate_total_charge);
                        $step3_rate_total_charge = sum(9, $step3_rate_total_charge);
                        jQuery('#rental_rate_subtotal').text('$'+$step3_rate_total_charge);

                        if(error['discount_code']){
                            jQuery('#promocode').text(error['discount_code']);
                            jQuery('#rental_rate_discount_percent').text('$'+error['rate']['discount']);
                            jQuery('#rental_rate_discount').text('$'+error['rate']['total']['discount']);
                        }
                        else{
                            jQuery('#discount').remove();
                        }

                        jQuery('#rental_rate_tax').text('$'+error['rate']['total']['taxes']);
                        jQuery('#rental_rate_total').text('$'+error['rate']['total']['charge']);
                        jQuery('#rental_rate_total_input').val(error['rate']['total']['charge']);
                        if(error['rate']['free_miles'] >0){
                            $free_mile = error['rate']['free_miles'] + ' miles/day';
                        }else{
                            $free_mile = 'Unlimited';
                        }
                        jQuery('#rental_rate_mileage').text($free_mile);

                        $pre_total = error['rate']['total']['charge'];
                        $charity_amount = roundupCalculation($pre_total)
                        jQuery('#step3-roundup span').text('$'+$charity_amount['charity']);
                        jQuery('#step3-roundup').attr('disabled', false);
                        jQuery('#step3-roundup').removeClass('disabled');
                        jQuery('#rental_rate_total_input').val($pre_total);
                        jQuery('#charity_total').val(0);
                        jQuery('input[name=step3-roundup-checkbox]').prop('checked', false);

                        //step5
                        jQuery('.rental_rate_detail').html(error['rate']['total']['days']+' day(s) @ '+error['rate']['daily_rate']+'<br/> ('+error['pick_up_date']+' - '+error['drop_off_date']+')');
						jQuery('.rental_rate_cost').text('$'+error['rate']['total']['rate_charge']);
                        jQuery('.rental_rate_subtotal').text('$'+$step3_rate_total_charge);

                        if(error['discount_code']){
                            jQuery('.promocode').text(error['discount_code']);
                            jQuery('.rental_rate_discount_percent').text('$'+error['rate']['discount']);
                            jQuery('.rental_rate_discount').text('$'+error['rate']['total']['discount']);
                        }
                        else{
                            jQuery('#discount').remove();
                        }

                        jQuery('.rental_rate_tax').text('$'+error['rate']['total']['taxes']);
                        jQuery('.rental_rate_total').text('$'+error['rate']['total']['charge']);
                        jQuery('.rental_rate_mileage').text($free_mile);
                        jQuery('.rental_date_range').text(error['pick_up_date']+' - '+error['drop_off_date']);

                        // end step3 show rate data

                        if(error['rental_period'] > 1 ){
                            coverage_data='';
                            // for(bundle in error['bundles']) {
                            //     coverage_data = coverage_data + '<tr>\
                            //                 <td class="w-4/6">'+error['bundles'][bundle]['desc']+'\
                            //                     <span title="'+error['bundles'][bundle]['note']+'">\
                            //                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600">\
                            //                         <circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>\
                            //                 </td>\
                            //                 <td class="w-1/6">'+error['bundles'][bundle]['amount'].toFixed(2)+'</td>\
                            //                 <td class="w-1/6">\
                            //                     <input class="select-coverage" name="opt['+error['bundles'][bundle]['id']+']" data-opt="'+error['bundles'][bundle]['id']+'" value="'+error['bundles'][bundle]['amount'].toFixed(2)+'" type="checkbox" title="'+error['bundles'][bundle]['desc']+'">\
                            //                 </td>\
                            //             </tr>';
                            // }
                            non_free = error['extras']['non-free']
                            for(index in non_free) {
                                    coverage_data = coverage_data + '<tr>\
                                                <td class="w-4/6">'+non_free[index]['desc']+'\
                                                    <span title="'+non_free[index]['note']+'">\
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600">\
                                                        <circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>\
                                                </td>\
                                                <td class="w-1/6">'+non_free[index]['amount'].toFixed(2)+'</td>\
                                                <td class="w-1/6">\
                                                    <input class="select-coverage" name="opt['+non_free[index]['id']+']" data-opt="'+non_free[index]['id']+'" value="'+non_free[index]['amount'].toFixed(2)+'" type="checkbox" title="'+non_free[index]['desc']+'">\
                                                </td>\
                                            </tr>';
                                }
                        }else{
                            coverage_data='<tr><td colspan="3" class="text-center">'+error['rental_period_text']+'</td></tr>';
                        }
                        jQuery('#coverage-data').html(coverage_data);
                        safety_data='';
                        for(extra_safety in error['extras']['free']) {
                            safety_data = safety_data + '<tr>\
                                        <td class="w-4/6">'+error['extras']['free'][extra_safety]['desc']+'\
                                            <span title="'+error['extras']['free'][extra_safety]['notes']+'">\
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle ml-1 w-4 text-gray-600">\
                                                <circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>\
                                        </td>\
                                        <td class="w-1/6">Free</td>\
                                        <td class="w-1/6">\
                                            <input name="opt['+error['extras']['free'][extra_safety]['id']+']" data-opt="'+error['extras']['free'][extra_safety]['id']+'" value="true" type="checkbox" title="'+error['extras']['free'][extra_safety]['desc']+'">\
                                        </td>\
                                    </tr>';
                        }
                        jQuery('#safety-data').html(safety_data);
                        step3RateCalculate();
                    }
                    jQuery('.step_2_submit').text('Select Vehicle');
                    jQuery('.step_2_submit').removeClass('disabled');

                });

            });
        }

        // Step3 js.........
            function rateTableData(){
                $content = '<tr>\
                                <td class="w-4/6">Rental Rate\
                                    <div id="rental_rate_detail"></div>\
                                </td>\
                                <td class="w-2/6" id="rental_rate_cost"></td>\
                            </tr>\
                            <tr id="rate-append-data">\
                                <td class="w-4/6">Admin Fee</td>\
                                <td class="w-2/6">$9.00</td>\
                            </tr>\
                            <tr>\
                                <td class="w-4/6">Subtotal</td>\
                                <td id="rental_rate_subtotal">$9.00</td>\
                            </tr>\
                            <tr id="discount">\
                                <td class="w-4/6">\
                                    Discount\
                                    <div><span id="promocode"></span> - <span id="rental_rate_discount_percent"></span>%</div>\
                                </td>\
                                <td class="w-2/6">\
                                    <div id="rental_rate_discount">$.70</div>\
                                </td>\
                            </tr>\
                            <tr>\
                                <td class="w-4/6">\
                                    Taxes and Fees <div>Sales Tax - 7.75%</div>\
                                </td>\
                                <td class="w-2/6">\
                                    <div id="rental_rate_tax">$.70</div>\
                                </td>\
                            </tr>\
                            <tr>\
                                <td>Mileage</td>\
                                <td id="rental_rate_mileage"></td>\
                            </tr>\
                            <tr>\
                                <td><b>Total</b></td>\
                                <td class="rental_rate_total" id="rental_rate_total">$9.70</td>\
                            </tr>';
                return $content;
            }
            function sum($new_value,$sum=0){
                return (parseFloat($sum)+parseFloat($new_value)).toFixed(2);
            }
            function subtraction($new_value,$sub){
                return (parseFloat($sub)-parseFloat($new_value)).toFixed(2);
            }

            function step3RateCalculate(){
                //coverage selection
                $check_status=false;
                $remove_status = false;
                jQuery('.select-coverage').on('change', function(){
                    if(jQuery(this).is(':checked')){
                        jQuery(".select-coverage").not(this).prop('checked', false);
                        $check_status=true;
                        // $remove_status = true;
                    }else{
                        jQuery(this).prop('checked', false);
                        $check_status=false;
                    }
                });
                jQuery('#step3-rate-calculate').on('click', function(){
                    jQuery('#step3-rate-container').removeClass('displaynone');
                    jQuery('#step3-rate-calculate').addClass('displaynone');
                    jQuery('#step3-rate-recalculate').removeClass('displaynone');
                    if($remove_status == true){
                        $c_cost = jQuery('#coverage-cost').text().replace('$','');
                        if($c_cost == '')
                            $c_cost = 0;
                        //console.log(jQuery('#coverage-cost').text());
                        $subtotal = jQuery('#rental_rate_subtotal').text().replace('$','');
                        $subtotal =subtraction($c_cost, $subtotal);
                        jQuery('#rental_rate_subtotal').text('$'+$subtotal);

                        $total = jQuery('#rental_rate_total').text().replace('$','');
                        //console.log(jQuery('#rental_rate_total').text());
                        $total = subtraction($c_cost,$total);
                        jQuery('#rental_rate_total').text('$'+$total);
                        jQuery('#rental_rate_total_input').val($total);
                        //console.log($total);
                        jQuery('#rate-append-data').next().remove();
                        $remove_status = false;

                        //step5
                        jQuery('.rental_rate_subtotal').text('$'+$subtotal);
                        jQuery('.rental_rate_total').text('$'+$total);
                        jQuery('.rate-append-data').next().remove();
                    }
                    if($check_status == true){
                        $remove_status = true;
                        if(jQuery('.select-coverage:checked')){
                            jQuery('#rate-append-data').after('<tr>\
                                              <td>'+jQuery('.select-coverage:checked').attr('title')+'</td>\
                                              <td id="coverage-cost">$'+jQuery('.select-coverage:checked').val()+'</td>\
                                          </tr>');
                            $subtotal = jQuery('#rental_rate_subtotal').text().replace('$','');
                            $subtotal =sum(jQuery('.select-coverage:checked').val(), $subtotal);
                            jQuery('#rental_rate_subtotal').text('$'+$subtotal);

                            $total = jQuery('#rental_rate_total').text().replace('$','');
                            $total = sum(jQuery('.select-coverage:checked').val(),$total);
                            jQuery('#rental_rate_total').text('$'+$total);
                            jQuery('#rental_rate_total_input').val($total);

                            //step5
                            jQuery('.rate-append-data').after('<tr>\
                                              <td>'+jQuery('.select-coverage:checked').attr('title')+'</td>\
                                              <td>$'+jQuery('.select-coverage:checked').val()+'</td>\
                                          </tr>');
                            jQuery('.rental_rate_subtotal').text('$'+$subtotal);
                            jQuery('.rental_rate_total').text('$'+$total);
                        }
                    }
                    $total_rental = jQuery('#rental_rate_total').text().replace('$','');
                    $charity_amount = roundupCalculation($total_rental)
                    jQuery('#step3-roundup span').text('$'+$charity_amount['charity']);
                    jQuery('#step3-roundup').attr('disabled', false);
                    jQuery('#step3-roundup').attr('disabled', false);

                });
                jQuery('#step3-rate-recalculate').on('click', function(){
                    if($remove_status == true){
                        $c_cost = jQuery('#coverage-cost').text().replace('$','');
                        if($c_cost == '')
                            $c_cost = 0;
                        //console.log(jQuery('#coverage-cost').text());
                        $subtotal = jQuery('#rental_rate_subtotal').text().replace('$','');
                        $subtotal =subtraction($c_cost, $subtotal);
                        jQuery('#rental_rate_subtotal').text('$'+$subtotal);

                        //$total = jQuery('#rental_rate_total').text().replace('$','');
                        //console.log(jQuery('#rental_rate_total').text());
                        //$total = subtraction($c_cost,$total);
                        $total = sum(jQuery('#rental_rate_tax').text().replace('$',''),$subtotal);
                        jQuery('#rental_rate_total').text('$'+$total);
                        jQuery('#rental_rate_total_input').val($total);

                        jQuery('#rate-append-data').next().remove();
                        $remove_status = false;

                        //step5
                        jQuery('.rental_rate_subtotal').text('$'+$subtotal);
                        jQuery('.rental_rate_total').text('$'+$total);
                        jQuery('.rate-append-data').next().remove();
                    }
                    if($check_status == true){
                        $remove_status = true;
                        if(jQuery('.select-coverage:checked')){
                            jQuery('#rate-append-data').after('<tr>\
                                              <td>'+jQuery('.select-coverage:checked').attr('title')+'</td>\
                                              <td id="coverage-cost">$'+jQuery('.select-coverage:checked').val()+'</td>\
                                          </tr>');
                            $subtotal = jQuery('#rental_rate_subtotal').text().replace('$','');
                            $subtotal =sum(jQuery('.select-coverage:checked').val(), $subtotal);
                            jQuery('#rental_rate_subtotal').text('$'+$subtotal);

                            //$total = jQuery('#rental_rate_total').text().replace('$','');
                            $total = sum(jQuery('#rental_rate_tax').text().replace('$',''),$subtotal);
                            jQuery('#rental_rate_total').text('$'+$total);
                            jQuery('#rental_rate_total_input').val($total);


                            //step5
                            jQuery('.rate-append-data').after('<tr>\
                                              <td>'+jQuery('.select-coverage:checked').attr('title')+'</td>\
                                              <td>$'+jQuery('.select-coverage:checked').val()+'</td>\
                                          </tr>');
                            jQuery('.rental_rate_subtotal').text('$'+$subtotal);
                            jQuery('.rental_rate_total').text('$'+$total);
                        }
                    }
                    $total_rental = jQuery('#rental_rate_total').text().replace('$','');
                    $charity_amount = roundupCalculation($total_rental)
                    jQuery('#step3-roundup span').text('$'+$charity_amount['charity']);
                    jQuery('input[name=step3-roundup-checkbox]').prop('checked', false);
                    jQuery('#charity_total').val(0);
                    jQuery('.donation-td').remove();

                });
            }

            function validateEmail(email) {
                let re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }

            function step3tostep4(){
                jQuery('#step_3_submit').on('click', function(){
                    jQuery('#step_3_submit').html('<span class="spinner-grow text-success spinner-grow-sm" role="status" aria-hidden="true"></span><span class="">Loading...</span>');
                    jQuery('#step_3_submit').addClass('disabled');
                    let url = '/wp-admin/admin-ajax.php';
                    var submit_data = step_3_collect();
                    let data = {
                            'action': 'step3_submit',
                            'data': {
                                'data': submit_data,
                                'total':jQuery('#rental_rate_total_input').val(),
                                'charity':jQuery('#charity_total').val()
                            }
                    };

                    jQuery.post(url, data, function(response) {
                        response = jQuery.parseJSON(response);
                        currentStep = 4;
                        jQuery('.zeeba_form.step').eq(2).css({display:'none'});
                        jQuery('.zeeba_form.step').eq(3).css({display:'block'});
                        jQuery('.zeeba_form.step').eq(4).css({display:'none'});
                        jQuery('#stepper3').addClass('completed');
                        jQuery('#stepper3').removeClass('active');
                        jQuery('#stepper4').addClass('active');

                        // start step3 show data
                        // jQuery('#step4-van-title').text(response['vehicle_title']);
                        // jQuery('#step4-van-img').attr('src',response['vehicle_img']);

                        jQuery('#step4_rental_period').text(response['rental_period']);
                        jQuery('#step4_total_price').text('$' + response['total']);


                        // step_4_agreement();
                        // step_4_add_driver();
                        // flightEnabled();
                        // // step_4_fileupload();
                        // step4Submit();
                        jQuery('.select2-container').css('width','100%');

                        jQuery('#step_3_submit').text('Last Step: 4');
                        jQuery('#step_3_submit').removeClass('disabled');

                    });
                });

            }

        // step4...
});
